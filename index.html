<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ESP32 Flowmeter Dashboard</title>
  <meta name="description" content="Live 5-camera dashboard with OCR readings. Zero-config. Drops into any static host." />
  <style>
    :root { --bg:#0b1020; --card:#111830; --muted:#7d8db1; --accent:#7aa2ff; --ok:#22c55e; --warn:#f59e0b; --err:#ef4444; }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
           background: radial-gradient(1200px 800px at 20% -10%, #18213f 0%, transparent 60%), var(--bg); color:#e6edff; }
    .wrap { max-width: 1300px; margin: 0 auto; padding: 18px; }
    header { display:flex; gap:14px; align-items:center; justify-content:space-between; margin-bottom: 16px; }
    .brand { display:flex; align-items:center; gap:12px; }
    .brand h1 { font-size: 20px; margin:0; letter-spacing:.3px; }
    .pill { font-size:12px; padding:6px 10px; border-radius:999px; background:#172149; color:#cfd9ff; border:1px solid #233069; }
    .pill.ok { background:rgba(34,197,94,.12); border-color: rgba(34,197,94,.35); color:#a7f3d0; }
    .pill.warn { background:rgba(245,158,11,.12); border-color: rgba(245,158,11,.35); color:#fde68a; }
    .pill.err { background:rgba(239,68,68,.12); border-color: rgba(239,68,68,.35); color:#fecaca; }
    .grid { display:grid; grid-template-columns: repeat(5, 1fr); gap:14px; }
    @media (max-width: 1200px){ .grid{ grid-template-columns: repeat(3, 1fr);} }
    @media (max-width: 800px){ .grid{ grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 540px){ .grid{ grid-template-columns: 1fr; } }
    .card { background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0)) , var(--card); border:1px solid #21305e; border-radius: 16px; overflow:hidden; box-shadow: 0 10px 30px rgba(3,8,20,.35) inset, 0 12px 30px rgba(3,8,20,.25); }
    .card header { padding:10px 12px; border-bottom:1px solid #1f2a56; background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0)); }
    .card h3 { margin:0; font-size:14px; font-weight:600; letter-spacing:.25px; }
    .feed { position: relative; background:#0a0f1f; aspect-ratio: 4 / 3; display:flex; align-items:center; justify-content:center; }
    .feed img, .feed video { width:100%; height:100%; object-fit: cover; display:block; }
    .fallback { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; color:#93a5d3; border-top:1px dashed #253261; }
    .meta { display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 12px 12px; }
    .reading { font-size:22px; font-weight:800; letter-spacing: .08em; color:#e9f1ff; }
    .label { font-size:11px; color: var(--muted); letter-spacing:.08em; text-transform: uppercase; }
    .ts { font-feature-settings: "tnum"; font-variant-numeric: tabular-nums; color:#9fb0db; font-size:12px; }
    .footer { display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:14px; color: #9fb0db; font-size:12px; }
    .link { color:#cfe0ff; text-decoration: none; border-bottom: 1px dotted #2a3a73; }
    .link:hover { color:#fff; border-color:#4c66d8; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2l3.5 6H20l-3.5 6L20 20h-4.5L12 22l-3.5-2H4l3.5-6L4 8h4.5L12 2z" stroke="#7aa2ff" stroke-width="1.2" fill="none"/>
        </svg>
        <h1>ESP32 Flowmeter Dashboard</h1>
      </div>
      <div id="mode-pill" class="pill warn">Detecting…</div>
    </header>

    <div id="app" class="grid"></div>

    <div class="footer">
      <div>
        <span class="label">Status:</span> <span id="status-text">Booting UI…</span>
      </div>
      <div>
        <span class="label">Endpoints:</span>
        <code id="endpoint-info">/api/readings · /stream/cam{1-5}</code>
      </div>
    </div>
  </div>

  <!-- React via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script>
(function(){
  const { useEffect, useState } = React;

  const DEFAULT_CAMS = [
    { id: 1, name: 'ME Flowmeter', url: 'http://192.168.0.59:81/stream' }, // ESP32 live camera
    { id: 2, name: 'Boiler Flowmeter', url: '' },
    { id: 3, name: 'GE IN Flowmeter', url: '' },
    { id: 4, name: 'GE OUT Flowmeter', url: '' },
    { id: 5, name: 'Cylinder Oil Flowmeter', url: '' },
  ];

  function formatTs(ts){
    try {
      const d = ts ? new Date(ts) : new Date();
      return d.toLocaleString();
    } catch(e){ return String(ts || ''); }
  }

  function Card({ cam, reading }){
    const [imgOk, setImgOk] = useState(true);
    return (
      React.createElement('div', { className: 'card' },
        React.createElement('header', null,
          React.createElement('h3', null, cam.name)
        ),
        React.createElement('div', { className: 'feed' },
          cam.url && imgOk
            ? React.createElement('img', {
                src: cam.url,
                alt: cam.name,
                onError: () => setImgOk(false),
              })
            : React.createElement('div', { className: 'fallback' },
                React.createElement('div', {style:{textAlign:'center', padding:'12px'}},
                  React.createElement('div', {style:{fontSize:'13px', marginBottom:'6px', color:'#9fb0db'}}, 'No Stream'),
                  React.createElement('div', {style:{fontSize:'12px', color:'#7d8db1'}}, 'Demo preview active')
                )
              )
        ),
        React.createElement('div', { className: 'meta' },
          React.createElement('div', null,
            React.createElement('div', { className: 'label' }, 'Reading'),
            React.createElement('div', { className: 'reading' }, reading.display)
          ),
          React.createElement('div', { className: 'ts' }, formatTs(reading.updatedAt))
        )
      )
    );
  }

  function App(){
    const [mode, setMode] = useState('live');

    useEffect(() => {
      const pill = document.getElementById('mode-pill');
      pill.textContent = 'Live Mode';
      pill.className = 'pill ok';
      document.getElementById('status-text').textContent = 'Connected to ESP32-S3 camera stream.';
      document.getElementById('endpoint-info').textContent = 'Direct ESP32 Stream Mode';
    }, []);

    const meters = DEFAULT_CAMS.map((c) => ({
      id: c.id,
      name: c.name,
      reading: '',
      unit: '',
      updatedAt: Date.now(),
    }));

    return (
      React.createElement(React.Fragment, null,
        meters.map((m, idx) => {
          const cam = DEFAULT_CAMS[idx];
          const disp = `${m.reading || '——'}${m.unit? ' '+m.unit : ''}`;
          const r = { display: disp, updatedAt: m.updatedAt };
          return React.createElement(Card, { key: cam.id, cam, reading: r });
        })
      )
    );
  }

  const root = ReactDOM.createRoot(document.getElementById('app'));
  root.render(React.createElement(App));
})();
</script>
</body>
</html>
